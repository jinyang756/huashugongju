<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="证券投资交流群话术工具 - 智能投资对话脚本生成系统，支持多种AI模型、投资风格和知识库增强功能，为投资者提供专业交流话术。">
    <title>证券投资交流群话术工具 - 智能投资对话生成系统</title>
    <link rel="stylesheet" href="css/optimized-styles.css">
        <link rel="stylesheet" href="css/knowledge-integration.css">
        <link rel="stylesheet" href="css/tabs.css">
</head>
<body>
    <!-- 导航栏 -->
    <header class="navbar">
        <div class="logo">
            <div class="logo-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                    <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                    <path d="M2 17L12 22L22 17"></path>
                    <path d="M2 12L12 17L22 12"></path>
                </svg>
            </div>
            <span>话术工具</span>
        </div>
        <nav class="nav-buttons">
            <button class="btn btn-secondary" id="settings-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M12 1v6m0 6v6m4.22-13.22l4.24 4.24M1.54 1.54l4.24 4.24M20.46 20.46l-4.24-4.24M1.54 20.46l4.24-4.24"></path>
                </svg>
                设置
            </button>
            <button class="btn btn-primary" id="new-conversation-btn">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                    <polyline points="14 2 14 8 20 8"></polyline>
                    <line x1="12" y1="18" x2="12" y2="12"></line>
                    <line x1="9" y1="15" x2="15" y2="15"></line>
                </svg>
                新建对话
            </button>
        </nav>
    </header>

    <div class="container">
        <!-- 左侧功能键 -->
        <aside class="left-panel">
            <section class="panel-section">
                <h3 class="section-title">功能导航</h3>
                <div class="menu-item active" data-menu-item="script-generator">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z"></path>
                    </svg>
                    脚本生成
                </div>
                <div class="menu-item" data-menu-item="knowledge-base">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                    </svg>
                    知识库管理
                </div>
                <div class="menu-item" data-menu-item="conversation-records">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    对话记录
                </div>
                <div class="menu-item" data-menu-item="upload-data">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    上传数据
                </div>
            </section>

            <section class="panel-section">
                <h3 class="section-title">高级功能</h3>
                <div class="menu-item" data-menu-item="optimization">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                    </svg>
                    优化建议
                </div>
                <div class="menu-item" data-menu-item="batch-generate">
                    <svg class="menu-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                    批量生成
                </div>
            </section>
        </aside>

        <!-- 中间内容区域 -->
        <main class="center-content">
            <!-- 对话标签容器 -->
            <div class="conversation-tabs" id="conversation-tabs">
                <div class="conversation-tab active" data-tab="1">
                    <span class="tab-number">1</span>
                    对话 1
                </div>
            </div>
            <!-- 对话容器 -->
            <div class="conversation-container" id="conversation-container">
                <!-- 对话面板 1 -->
                <div class="conversation-panel" data-panel="1">
                    <div class="toolbar">
                        <div class="search-bar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                            <input type="text" class="search-input" placeholder="搜索知识库或对话记录...">
                        </div>
                        <div class="status-indicator">
                            <span class="status-dot online"></span>
                            <span class="status-text">AI模型已就绪</span>
                        </div>
                    </div>

                    <div class="content-area">
                <!-- 统计面板 -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">1,248</div>
                        <div class="stat-label">生成的脚本</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">89%</div>
                        <div class="stat-label">准确率</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">324</div>
                        <div class="stat-label">活跃群组</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">15.2K</div>
                        <div class="stat-label">知识条目</div>
                    </div>
                </div>

                <!-- 脚本生成器 -->
                <section class="script-generator">
                    <div class="input-section">
                        <div class="card-header">
                            <h3 class="card-title">输入上下文</h3>
                            <span class="card-badge badge-warning">待处理</span>
                        </div>
                        <p class="section-description">
                            请输入对话的背景信息、场景描述或历史对话，AI将基于这些内容生成合适的对话脚本。
                        </p>
                        <div class="textarea-container">
                            <textarea id="input-textarea" class="custom-textarea" placeholder="例如：生成一段分析师与投资者关于近期市场走势的对话，投资者对后市走势有疑虑，需要分析师提供专业分析和投资建议..."></textarea>
                        </div>
                        <div class="action-buttons">
                            <button class="action-btn btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                    <polyline points="7 3 7 8 15 8"></polyline>
                                </svg>
                                保存草稿
                            </button>
                            <button id="generate-btn" class="action-btn generate-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                                </svg>
                                生成脚本
                            </button>
                        </div>
                    </div>

                    <div class="output-section">
                        <div class="card-header">
                            <h3 class="card-title">生成结果</h3>
                            <span class="card-badge badge-success">已完成</span>
                        </div>
                        <p class="section-description">
                            AI生成的对话脚本将显示在这里，可以直接复制使用或进行二次编辑。
                        </p>
                        <div class="textarea-container">
                            <textarea id="output-textarea" class="custom-textarea" readonly>分析师: 您好！感谢您的关注。近期市场波动较大，主要受宏观经济数据和政策面影响，我可以为您做个详细分析。

投资者: 最近大盘一直在震荡，我有点担心后市走势，您觉得接下来市场会怎么走？

分析师: 从技术面来看，大盘目前处于关键支撑位附近，成交量有所萎缩，短期内可能延续震荡整理态势。不过从基本面角度，经济复苏趋势明显，企业盈利改善，中长期依然看好。建议您可以关注一些业绩优良的蓝筹股和政策支持的科技成长板块。

投资者: 那您有什么具体的板块或个股推荐吗？我想调整一下我的持仓结构。

分析师: 我建议您可以关注新能源和半导体这两个领域。新能源是国家战略方向，政策支持力度大；半导体行业处于国产替代加速期，成长性较好。具体个股方面，您可以关注XX科技和YY能源，这两家公司基本面扎实，估值合理，具有较好的投资价值。</textarea>
                        </div>
                        <div class="action-buttons">
                            <button id="copy-btn" class="action-btn btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                    <polyline points="21 15 16 10 5 21"></polyline>
                                </svg>
                                复制结果
                            </button>
                            <button id="edit-btn" class="action-btn btn-secondary">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                </svg>
                                编辑优化
                            </button>
                        </div>
                    </div>
                </section>

                <!-- 最近生成记录 -->
                <section class="recent-records">
                    <div class="card-actions">
                        <button id="clear-records-btn" class="btn btn-sm btn-secondary">
                            清空记录
                        </button>
                    </div>
                    <div class="card-header">
                        <h3 class="card-title">最近生成记录</h3>
                    </div>
                    <div class="record-item">
                            <div class="record-title">市场走势分析对话</div>
                            <div class="record-meta">
                                <span>今天 14:35</span>
                                <span>准确率: 92%</span>
                            </div>
                        </div>
                        <div class="record-item">
                            <div class="record-title">个股投资建议交流</div>
                            <div class="record-meta">
                                <span>昨天 09:12</span>
                                <span>准确率: 87%</span>
                            </div>
                        </div>
                        <div class="record-item">
                            <div class="record-title">行业板块轮动分析</div>
                            <div class="record-meta">
                                <span>2023-10-28</span>
                                <span>准确率: 94%</span>
                            </div>
                        </div>
                </section>
            </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 右侧设置面板 -->
        <aside class="right-settings-panel">
            <div class="settings-container">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">生成设置</h3>
                    </div>
                    <div class="form-group">
                        <label for="model-select">AI模型选择</label>
                    <select id="model-select" name="model" class="form-select">
                        <option value="gpt-4-turbo-investment" selected>GPT-4 Turbo 金融版</option>
                        <option value="gpt-3.5-investment">GPT-3.5 投资助手</option>
                        <option value="finance-pro">Finance Pro</option>
                        <option value="stock-analyst">Stock Analyst</option>
                        <option value="market-insight">Market Insight</option>
                        <option value="investment-advisor">Investment Advisor</option>
                        <option value="wealth-manager">Wealth Manager</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="role-select">对话角色</label>
                    <select id="role-select" name="role" class="form-select">
                        <option value="分析师-投资者">分析师-投资者</option>
                        <option value="资深股民-新手">资深股民-新手</option>
                        <option value="基金经理-客户">基金经理-客户</option>
                        <option value="投资顾问-咨询者">投资顾问-咨询者</option>
                        <option value="技术高手-学习者">技术高手-学习者</option>
                        <option value="价值投资者-讨论者">价值投资者-讨论者</option>
                        <option value="短线交易者-交流者">短线交易者-交流者</option>
                        <option value="行业专家-关注者">行业专家-关注者</option>
                        <option value="量化分析员-实践者">量化分析员-实践者</option>
                        <option value="财经媒体人-读者">财经媒体人-读者</option>
                        <option value="股票推荐者-跟随者">股票推荐者-跟随者</option>
                        <option value="市场评论员-听众">市场评论员-听众</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="style-select">对话风格</label>
                    <select id="style-select" name="style" class="form-select">
                        <option value="专业分析">专业分析</option>
                        <option value="热情分享">热情分享</option>
                        <option value="轻松交流">轻松交流</option>
                        <option value="深度推荐">深度推荐</option>
                        <option value="共鸣理解">共鸣理解</option>
                        <option value="技术派交流">技术派交流</option>
                        <option value="基本面分析">基本面分析</option>
                        <option value="风险提示">风险提示</option>
                        <option value="价值投资">价值投资</option>
                        <option value="量化分析">量化分析</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="length-select">对话长度</label>
                    <select id="length-select" name="length" class="form-select">
                        <option value="short">简短对话 (3-5轮)</option>
                        <option value="medium">中等对话 (6-8轮)</option>
                        <option value="long">深度对话 (9-12轮)</option>
                        <option value="very-long">详尽对话 (13-16轮)</option>
                        <option value="custom">定制 (可自定义轮次)</option>
                    </select>
                </div>
                <div id="custom-length-container" class="form-group" style="display: none;">
                    <label for="custom-length-input">自定义轮次</label>
                    <input id="custom-length-input" type="number" name="custom-length" min="1" max="50" value="20" class="form-control">
                </div>
            </div>
        </aside>
    </div>

    <!-- 知识库管理模块 -->
    <section class="knowledge-base-container">
        <div class="knowledge-base-header">
            <h2>知识库管理</h2>
            <div class="knowledge-base-actions">
                <button id="file-upload-btn" class="btn btn-primary">
                    <i class="fas fa-upload"></i> 上传文件
                </button>
                <input type="file" id="file-input" multiple accept=".txt,.csv,.json" style="display: none;">
                <button id="add-text-knowledge-btn" class="btn btn-secondary">
                    <i class="fas fa-plus"></i> 添加文本
                </button>
            </div>
        </div>
        
        <!-- 搜索框 -->
        <div class="search-section">
            <input 
                type="text" 
                id="knowledge-search-input" 
                placeholder="搜索知识库内容..."
                class="search-input"
            >
        </div>
        
        <!-- 知识库项目列表 -->
        <div class="knowledge-items-container">
            <!-- 知识库项目会通过JS动态加载 -->
        </div>
    </section>
    
    <!-- 添加文本知识模态框 -->
    <div id="text-knowledge-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加文本知识</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="text-knowledge-form">
                    <div class="form-group">
                        <label for="knowledge-title">标题</label>
                        <input type="text" id="knowledge-title" required>
                    </div>
                    <div class="form-group">
                        <label for="knowledge-content">内容</label>
                        <textarea id="knowledge-content" rows="10" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="knowledge-tags">标签（用逗号分隔）</label>
                        <input type="text" id="knowledge-tags" placeholder="例如: 产品, 价格, 营销">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">保存</button>
                        <button type="button" class="btn btn-secondary modal-close">取消</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 按照正确顺序加载所有JavaScript文件 -->
    <script src="js/utils.js"></script>
    <script src="js/chunkingOptimizer.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/telegramIntegration.js"></script>
    <script src="js/scriptGenerator.js"></script>
    <script src="js/knowledgeBase.js"></script>
    <script src="js/main.js"></script>
    
    <!-- 处理自定义轮次输入框的显示/隐藏逻辑 -->
    <script>
        // 获取元素
        const lengthSelect = document.getElementById('length-select');
        const customLengthContainer = document.getElementById('custom-length-container');
        
        // 初始化检查
        function checkLengthSelection() {
            if (lengthSelect.value === 'custom') {
                customLengthContainer.style.display = 'block';
            } else {
                customLengthContainer.style.display = 'none';
            }
        }
        
        // 添加事件监听器
        if (lengthSelect && customLengthContainer) {
            lengthSelect.addEventListener('change', checkLengthSelection);
            // 初始化时检查一次
            checkLengthSelection();
        }
    </script>
</body>
</html>